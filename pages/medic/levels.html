<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medic - levels</title>
    <link rel="stylesheet" href="../../assets/styles/css/main.css">
</head>
<body class="page-levels">
    <!--HEADER-->
    <div class="header medic-header">
        <div class="top-header"></div>
        <div class="bottom-header">
            <div class="grid-header-levels">
                <div class="title-subtitle">
                    <h1 class="header-title" style="margin-top: 0px">Aide médicale</h1>
                    <h4 class="header-subtitle">Les gestes qui sauvent</h4>
                </div>
                <div class="rectangular-button back-to-home theme-medic">
                    <img src="../../assets/img/icons/close-x.png">
                </div>
            </div>
        </div>
    </div>

    <!--LEVEL TEMPLATE-->
    <div class="template-level" id="level-template" style="display: none;">
        <div class="grid-level-buttons">
            <div class="diamond-button medic-level-button">
                <span>1</span>
            </div>
            <div class="description">
                <h2>La RCP</h2>
            </div>
        </div>

        <!--PLAYER-->
        <div class="rectangular-box-levels">
            <div class="grid-rectangular-box-level">
                <img src="../../assets/img/icons/levels-medic/chrono-1-3.png">
                <img src="../../assets/img/icons/levels-medic/diff-1-amu.png">
                <img src="../../assets/img/icons/levels-medic/play-amu.png" class="play-button" data-level="1">
                <span>5 min</span>
                <span>facile</span>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="../../js/jquery-3.7.1.min.js"></script>
    <script src="../../js/back-to-buttons.js"></script>
    <script>
        $(document).ready(function () {
            const domaine = 'medic';

            $.getJSON('../../assets/json/exercices_data.json', function (data) {
                const niveaux = data[domaine];  // Récupérer les exercices du domaine spécifique
                const $template = $('#level-template');
                let index = 0;

                // Parcours des niveaux et ajout des données dans le DOM
                for (const niveauKey in niveaux) {
                    index++;
                    const info = niveaux[niveauKey];
                    const $clone = $template.clone().removeAttr('id').show();

                    // Mise à jour des informations texte pour chaque niveau
                    $clone.find('.diamond-button span').text(index);
                    $clone.find('h2').text(info.titre);
                    const $spans = $clone.find('.grid-rectangular-box-level span');
                    $spans.eq(0).text(info.temps);
                    $spans.eq(1).text(info.difficulte);

                    // Déterminer le niveau de chrono en fonction de la durée
                    let chronoLevel = "1third"; // Par défaut
                    const tempsNum = parseInt(info.temps);
                    if (tempsNum >= 6) {
                        chronoLevel = "3third";
                    } else if (tempsNum >= 4) {
                        chronoLevel = "2third";
                    }

                    // Déterminer le niveau de difficulté
                    let diffLevel = "1third"; // Par défaut
                    if (info.difficulte === "facile") {
                        diffLevel = "1third";
                    } else if (info.difficulte === "moyen") {
                        diffLevel = "2third";
                    } else if (info.difficulte === "difficile") {
                        diffLevel = "3third";
                    }

                    // Mise à jour des images dynamiques pour le chrono et la difficulté
                    $clone.find('img[src*="chrono"]').attr('src', `../../assets/img/icons/levels-${domaine}/${domaine}-chrono-${chronoLevel}.png`);
                    $clone.find('img[src*="diff"]').attr('src', `../../assets/img/icons/levels-${domaine}/${domaine}-diff-${diffLevel}.png`);

                    // Cacher le player au départ
                    $clone.find('.rectangular-box-levels').hide();

                    // Mettre à jour le bouton play avec le bon niveau et domaine
                    $clone.find('.play-button')
                        .attr('data-niveau', niveauKey)
                        .attr('data-domaine', domaine);

                    // Ajouter l'élément cloné au DOM
                    $template.after($clone);
                }
            });

            // Gérer le clic sur le bouton niveau (afficher/cacher le player)
            $(document).on('click', '.grid-level-buttons', function () {
                var $levelBlock = $(this).closest('.template-level');
                var $playerBox = $levelBlock.find('.rectangular-box-levels');
                $('.rectangular-box-levels').not($playerBox).slideUp();
                $playerBox.stop(true, true).slideToggle();
            });

            // Gérer les clics sur les boutons play (redirection vers la page de l'exercice)
            $(document).on('click', '.play-button', function () {
                const niveau = $(this).data('niveau');
                const domaine = $(this).data('domaine');
                window.location.href = `exercice.html?domaine=${domaine}&niveau=${niveau}`;
            });
        });
    </script>
</body>
</html>
