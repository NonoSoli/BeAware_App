<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice-prevent</title>
    <link rel="stylesheet" href="../../assets/styles/css/main.css">
</head>
<script src="../../js/jquery-3.7.1.min.js"></script>
<script src="../../js/back-to-buttons.js"></script>
    
<body>
    <!--HEADER-->
    <div class="header prevent-header">
        <div class="top-header"></div>
        <div class="bottom-header">
            <div class="header-exercice">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill"></div>
                </div>
            </div>
            <div class="grid-header-levels">
                <div class="title-subtitle">
                    <h1 class="header-title" style="margin-top: 0px">Prévention</h1>
                    <h4 class="header-subtitle exercice-title"></h4>
                </div>
                <div class="rectangular-button-prevent back-to-home">
                    <img src="../../assets/img/icons/close-x.png">
                </div>
            </div>
        </div>
    </div>
    
  
    <div class="main-container">
      <h2 class="exercice-description"></h2>
      <div class="exercice-options"></div>
      <div class="feedback"></div>
      <button class="next-button" style="display: none;">Suivant</button>
    </div>
  
    <script>
      let currentIndex = 0;
      let exercicesData = [];
    
      function getParam(name) {
        return new URLSearchParams(window.location.search).get(name);
      }
    
      function updateProgress() {
        const percentage = ((currentIndex + 1) / exercicesData.length) * 100;
        $('.progress-bar-fill').css('width', percentage + '%');
      }
    
      // Fonction pour mélanger un tableau de manière aléatoire
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]]; // Échanger les éléments
        }
      }
    
      function afficherExercice(index) {
        const exercice = exercicesData[index];
    
        $('.exercice-title').text(exercice.titre);
        $('.exercice-description').text(exercice.description);
        $('.temps-estime').text(exercice.temps_estime);
        $('.consignes-list').empty();
        $('.exercice-options').empty();
        $('.feedback').empty();
        $('.next-button').hide();
    
        // Mélanger les options avant de les afficher
        shuffleArray(exercice.options);
    
        exercice.options.forEach(option => {
          const btn = $('<button class="option-button">')
            .append(
              $('<div class="rectangular-choice">').append($('<span>').text(option.texte))
            )
            .on('click', function () {
              if ($(this).hasClass('clicked')) return;
              $(this).addClass('clicked');
              $(this).find('.rectangular-choice').addClass(option.correcte ? 'bonne-reponse' : 'mauvaise-reponse');
              $('.feedback').text(option.feedback);
              if (option.correcte) {
                $('.option-button').prop('disabled', true);
                $('.next-button').fadeIn();
              }
            });
    
          $('.exercice-options').append(btn);
        });
    
        updateProgress();
      }
    
      $(document).ready(function () {
        const domaine = getParam('domaine') || 'medic';
        const niveau = getParam('niveau') || 'niveau_1';
    
        $.getJSON('../../assets/json/exercices_data.json', function (data) {
          exercicesData = data[domaine][niveau].exercices;
          afficherExercice(currentIndex);
        });
    
        $('.next-button').on('click', function () {
          currentIndex++;
          if (currentIndex < exercicesData.length) {
            afficherExercice(currentIndex);
          } else {
            window.location.href = '../../../home.html'; // Redirection après le dernier exercice
          }
        });
      });
    </script>
  </body>
</html>