<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice-medic</title>
    <link rel="stylesheet" href="../../assets/styles/css/main.css">
</head>
<script src="../../js/jquery-3.7.1.min.js"></script>
<script src="../../js/back-to-buttons.js"></script>
    
<body>
    <!--HEADER-->
    <div class="header prevent-header">
        <div class="top-header"></div>
        <div class="bottom-header">
            <div class="header-exercice">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill"></div>
                </div>
            </div>
            <div class="grid-header-levels">
                <div class="title-subtitle">
                    <h1 class="header-title" style="margin-top: 0px">Aide médicale</h1>
                    <h4 class="header-subtitle exercice-title"></h4>
                </div>
                <div class="rectangular-button-prevent back-to-home">
                    <img src="../../assets/img/icons/close-x.png">
                </div>
            </div>
        </div>
    </div>
    
  
    <div class="main-container">
      <h2 class="exercice-description"></h2>
      <div class="exercice-options"></div>
      <div class="feedback"></div>
      <button class="next-button" style="display: none;">Suivant</button>
    </div>
  
    <script>
      let currentIndex = 0;
      let exercicesData = [];

      // Fonction pour récupérer le paramètre "niveau" de l'URL
      function getNiveauFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('niveau') || '1'; // Si pas de niveau spécifié, on charge le niveau 1 par défaut
      }

      function updateProgress() {
        const percentage = ((currentIndex + 1) / exercicesData.length) * 100;
        $('.progress-bar-fill').css('width', percentage + '%');
      }

      function afficherExercice(index) {
        const exercice = exercicesData[index];

        // Réinitialisation du contenu
        $('.exercice-title').text(exercice.titre);
        $('.exercice-description').text(exercice.description);
        $('.temps-estime').text(exercice.temps_estime);
        $('.consignes-list').empty();
        $('.exercice-options').empty();
        $('.feedback').empty();
        $('.next-button').hide();

        exercice.options.forEach(option => {
          const btn = $('<button class="option-button">')
            .append(
              $('<div class="rectangular-choice">')
                .append($('<span>').text(option.texte))
            )
            .on('click', function () {
              // Empêcher les clics répétés sur le même bouton
              if ($(this).hasClass('clicked')) return;

              $(this).addClass('clicked');

              // Marquer la bonne ou mauvaise réponse
              $(this).find('.rectangular-choice').addClass(option.correcte ? 'bonne-reponse' : 'mauvaise-reponse');

              // Afficher le feedback
              $('.feedback').text(option.feedback);

              // Si bonne réponse : bloquer tous les autres boutons et afficher "Suivant"
              if (option.correcte) {
                $('.option-button').prop('disabled', true);
                $('.next-button').fadeIn();
              }
            });

          $('.exercice-options').append(btn);
        });

        updateProgress();
      }

      $(document).ready(function () {
        // Récupérer le niveau depuis l'URL
        const niveau = getNiveauFromURL();
        const fichier = `../../assets/json/exercices/medic_level_${niveau}.json`; // Charger le fichier dynamique en fonction du niveau

        // Charger les exercices
        $.getJSON(fichier, function (data) {
          exercicesData = data.exercices;
          afficherExercice(currentIndex);
        });

        // Gérer l'action du bouton "Suivant"
        $('.next-button').on('click', function () {
          currentIndex++;
          if (currentIndex < exercicesData.length) {
            afficherExercice(currentIndex);
          } else {
            window.location.href = '../../../home.html'; // Rediriger vers la page des niveaux une fois l'exercice terminé
          }
        });
      });

    </script>
  </body>
</html>