<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Levels</title>
    <link rel="stylesheet" href="../../assets/styles/css/main.css">
    <link rel="stylesheet" href="../../assets/styles/css/home-button.css">
</head>
<body class="page-levels">
    <!-- HEADER dynamique -->
    <div class="header" id="header-dynamique">
        <div class="top-header"></div>
        <div class="bottom-header">
            <div class="grid-header-levels">
                <div class="title-subtitle">
                    <h1 class="header-title" id="header-title"></h1>
                    <h4 class="header-subtitle">Bien réagir, bien maitriser</h4>
                </div>
                <div class="rectangular-button back-to-home">
                    <img src="../../assets/img/icons/close-x.png">
                </div>
            </div>
        </div>
    </div>

    <!-- LEVEL TEMPLATE -->
    <div class="template-level" id="level-template" style="display: none;">
        <div class="grid-level-buttons">
            <div class="diamond-button home-button">
                <span>1</span>
            </div>
            <div class="description">
                <h2>La RCP</h2>
            </div>
        </div>
        <div class="rectangular-box-levels">
            <div class="grid-rectangular-box-level">
                <img class="chrono" src="">
                <img class="diff" src="">
                <img class="play-button" src="" data-level="">
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="../../js/jquery-3.7.1.min.js"></script>
    <script src="../../js/back-to-buttons.js"></script>
    <script>
        $(document).ready(function () {
            const params = new URLSearchParams(window.location.search);
            const domaine = params.get('domaine');

            $.getJSON('../../assets/json/exercices_data.json', function (data) {
                const domaineData = data[domaine];
                const niveaux = domaineData.niveaux;
                const couleur = domaineData.color;
                const icon = domaineData.icon;

                // Mise à jour dynamique du header
                $('#header-dynamique').css('--domain-color', couleur);
                $('#header-title').text(domaine.charAt(0).toUpperCase() + domaine.slice(1));
                $('.rectangular-button').css('background-color', couleur);

                const $template = $('#level-template');
                let index = 0;

                for (const niveauKey in niveaux) {
                    index++;
                    const info = niveaux[niveauKey];
                    const $clone = $template.clone().removeAttr('id').show();

                    $clone.find('.diamond-button span').text(index);
                    $clone.find('h2').text(info.titre);

                    const $spans = $clone.find('.grid-rectangular-box-level span');
                    $spans.eq(0).text(info.temps);
                    $spans.eq(1).text(info.difficulte);

                    let chronoLevel = "1third";
                    const tempsNum = parseInt(info.temps);
                    if (tempsNum >= 6) chronoLevel = "3third";
                    else if (tempsNum >= 4) chronoLevel = "2third";

                    let diffLevel = "1third";
                    if (info.difficulte === "moyen") diffLevel = "2third";
                    else if (info.difficulte === "difficile") diffLevel = "3third";

                    $clone.find('img.chrono').attr('src', `../../assets/img/icons/levels-${domaine}/${domaine}-chrono-${chronoLevel}.png`);
                    $clone.find('img.diff').attr('src', `../../assets/img/icons/levels-${domaine}/${domaine}-diff-${diffLevel}.png`);
                    $clone.find('img.play-button')
                        .attr('src', `../../assets/img/icons/levels-${domaine}/play-${domaine}.png`)
                        .attr('data-niveau', niveauKey)
                        .attr('data-domaine', domaine);

                    $clone.find('.rectangular-box-levels').hide();

                    $template.after($clone);
                }
            });

            $(document).on('click', '.grid-level-buttons', function () {
                const $box = $(this).closest('.template-level').find('.rectangular-box-levels');
                $('.rectangular-box-levels').not($box).slideUp();
                $box.stop(true, true).slideToggle();
            });

            $(document).on('click', '.play-button', function () {
                const niveau = $(this).data('niveau');
                const domaine = $(this).data('domaine');
                window.location.href = `exercice.html?domaine=${domaine}&niveau=${niveau}`;
            });
        });
    </script>
</body>
</html>
